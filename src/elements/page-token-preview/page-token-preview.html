<link rel="import" href="../../bower-assets/polymer/polymer.html">
<link rel="import" href="../../styles/common-style.html">

<!-- behavior -->
<link rel="import" href="../../behaviors/common-computes.html">
<link rel="import" href="../../behaviors/db-using.html">
<link rel="import" href="../../behaviors/page-like.html">
<link rel="import" href="../../behaviors/api-calling.html">

<!-- custom-elements -->

<!-- element -->
<dom-module id="page-token-preview">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        width: 100%;
        
      }
      .a8 {
        position: relative;
        height: 7.4cm;
        width: 5.2cm;
        background-color: #fff;
      }

      .topbar {
        background-color: #fafafa;
        padding: 4px;
        text-align: center;
        border-bottom: 2px solid black;
      }

      .bottom {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #eee;
      }
      .middle {
        margin-top: 4px;
      }

    </style>

    <div class="a8">
      <div class="topbar" >
        <div class="type caption-2" style="max-height: 128px;">{{token.data.organizationName}}</div>
      </div>
      <div class="middle">
        <div class="type caption-2">
          <div><strong>PatientId:</strong> {{token.data.patientSerial}}</div>
          <div><strong>Patients:</strong> {{$getFullName(token.data.patientName)}}</div>
          <div><strong>Phone Number:</strong>  {{token.data.patientPhone}}</div>
        </div>
        <hr>
        <div style="text-align: center;">
          <div class="type caption secondary"><strong>TOKEN NO.</strong></div>
          <div class="type headline">{{token.serial}}</div>
        </div>
        
        <hr>
        <div class="type body">
          <div><strong>Department:</strong> {{token.data.departmentName}}</div>
          <div><strong>Room No:</strong> {{token.data.roomNumber}}</div>
      </div>
      <div class="bottom">
        <div class="type caption"><i>generated by: {{token.createdByUserName}}</i></div>
      </div>
    </div>
      


  </template>
  <script>
    Polymer({
      is: 'page-token-preview',
      behaviors: [
        app.behaviors.commonComputes,
        app.behaviors.dbUsing,
        app.behaviors.pageLike,
        app.behaviors.apiCalling
      ],
      properties: {
        token: Object
      },

      _getTokenData (identifier) {
        console.log(identifier);
        this.callApi('/bdemr-get-patient-token', {tokenId: identifier}, (err, response) => {
          console.log(response);

          if (response.hasError) {
            this.domHost.showToast(response.error.message);
          }
          else {
            this.set('token', response.data);
          }
        })
      },
        
      navigatedIn() {
        const params = this.domHost.getPageParams()
        let tokenId = params['id'];
        this._getTokenData(tokenId);
      },

      printButtonPressed() {
        window.print();
      },

      arrowBackButtonPressed() {
        this.domHost.navigateToPreviousPage()
      }

    });
  </script>
</dom-module>